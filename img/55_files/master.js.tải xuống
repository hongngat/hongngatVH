var ismobile = $(window).width() < 1010; var istablet = ismobile && $(window).width() >= 768;
if (typeof TNO_Top_Banner_v3 == "undefined" || TNO_Top_Banner_v3.aNodes.length == 0) {
    document.getElementById("headerTopBanner").remove();
}
(function (w, d) {
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script");
    var v = !("IntersectionObserver" in w) ? "8.17.0" : "10.19.0";
    s.async = true; // This includes the script as async. See the "recipes" section for more information about async loading of LazyLoad.
    //s.src = "https://cdn.jsdelivr.net/npm/vanilla-lazyload@" + v + "/dist/lazyload.min.js";
    s.src = "https://static.thanhnien.vn/v3/jscripts/lazyload-" + v + "/lazyload.min.js";
    w.lazyLoadOptions = [{/* Your options here */ }, { elements_selector: ".lazy", callback_loaded: function () { updatestickypos(); } }];
    b.appendChild(s);
}(window, document));
///*--- Sticky ---*/
//$("#header").sticky({ topSpacing: 0 });
displayBanner();
function playvideos() {
    for (var i = 0; i < videos.length; i++) {
        var videourl = videos[i][1];
        if (videourl.indexOf('<video ') >= 0 || videourl.indexOf('<iframe ') >= 0) {
            playvideovccorp(videos[i][0], videos[i][1], videos[i][2], videos[i][3], videos[i][4], videos[i][5]);
        }else {
            playvideo(videos[i][0], videos[i][1], videos[i][2], videos[i][3], videos[i][4], videos[i][5]);
        }
    }
    videos = [];
}
function playvideovccorp(id_, src_, img_, width_, height_, container_) {
    if ($('#' + id_).parents('.l-content').length > 0) {
        container_ = container_ - 20;
    }
    if ($('#' + id_).parents('#livestream').length > 0) {
        container_ = container_ - 120;
    }
    if ($('#' + id_).parents('.quote.has-background').length > 0) {
        container_ = container_ - 40;
    }
    if (width_ > container_) {
        height_ = Math.round(height_ * container_ / width_);
        width_ = container_;
    }
    var vtype = '1';
    if ($('#' + id_).parents('#abody').length > 0) { vtype = '1'; }
    else if (id_ == 'post-player') { vtype = '9'; }
    else if (window.location.host == 'video.thanhnien.vn') { vtype = '3'; }

    var video = $('<div>' + src_ + "</div>");
    video.find('video,source').removeAttr('src');
    video.find('video,iframe')
        .attr('id', id_ + "_video")
        .attr('width', width_ + 'px')
        .attr('height', height_ + 'px')
        .attr('class', isbeta ? 'BetaThanhnienPlayer' : 'player-100114 VFCPlayer').addClass('cms-video').attr('data-mute', 'true').attr('data-filler', 'false')
        .attr('data-vtype', vtype);
    video.find('video[poster]').each(function () { $(this).attr('data-poster', $(this).attr('poster')); });
    if ($('#' + id_).parents('#abody,#contentAvatar').length > 0) {
        video.find('video').attr('data-enableFloat', 'true');
    }
    //console.log(video.html());
    $('#' + id_).html(video.html());
    var contentId = video.find('video, iframe').attr("data-contentId");
    if (typeof contentId != 'undefined' && contentId != '') {
        $.ajax({
            type: 'POST',
            url: '/ajax/vccorpdrm.ashx',
            data: {
                contentId: contentId
            },
            dataType: "json",
            success: function (data) {
                //var data = res.Data;
                //if (typeof (data) == 'string') data = JSON.parse(data);
                //console.log(data);
                $('#' + id_ + "_video").attr('data-drmtoken', data.kmsSdkToken);
                initvccorp();
            }
        });
    } else if (videos.length == 0) {
        initvccorp();
    }
}

function playvideo(id_, src_, img_, width_, height_, container_) {
    if ($('#' + id_).parents('.l-content').length > 0) {
        container_ = container_ - 20;
    }
    if ($('#' + id_).parents('#livestream').length > 0) {
        container_ = container_ - 120;
    }
    if ($('#' + id_).parents('.quote.has-background').length > 0) {
        container_ = container_ - 40;
    }
    if (width_ > container_) {
        height_ = Math.round(height_ * container_ / width_);
        width_ = container_;
    }
    var vtype = '1';
    if ($('#' + id_).parents('#abody').length > 0) { vtype = '1'; }
    else if (id_ == 'post-player') { vtype = '9'; }
    else if (window.location.host == 'video.thanhnien.vn') { vtype =  '3'; }

    if (src_.indexOf('<video ') >= 0 || src_.indexOf('<iframe ') >= 0) {
        var video = $('<div>' + src_ + "</div>");
        video.find('video,source').removeAttr('src');
        video.find('video,iframe')
            .attr('id', id_ + "_video")
            .attr('width', width_ + 'px')
            .attr('height', height_ + 'px')
            .attr('class', isbeta ? 'BetaThanhnienPlayer' : 'player-100114 VFCPlayer').attr('data-vtype', vtype).attr('data-mute', 'true').attr('data-filler', 'false');
        video.find('video[poster]').each(function () { $(this).attr('data-poster', $(this).attr('poster')); });
        $('#' + id_).html(video.html());
        var contentId = video.find('video, iframe').attr("data-contentId");
        if (typeof contentId != 'undefined' && contentId != '') {
            $.ajax({
                type: 'POST',
                url: '/ajax/vccorpdrm.ashx',
                data: {
                    contentId: contentId
                },
                dataType: "json",
                success: function (data) {
                    //var data = res.Data;
                    //if (typeof (data) == 'string') data = JSON.parse(data);
                    //console.log(data);
                    $('#' + id_ + "_video").attr('data-drmtoken', data.kmsSdkToken);
                    initvccorp();
                }
            });
        } else if (videos.length == 0) {
            initvccorp();
        }
    } else {

        if (src_.indexOf('https://streaming.thanhnien.vn/') >= 0) {
            var idx = src_.toLowerCase().indexOf('/videostore/');
            if (idx > 0) {
                src_ = src_.substr(idx);
            } else {
                idx = src_.toLowerCase().indexOf('/uploaded/');
                if (idx > 0) {
                    src_ = src_.substr(idx);
                }
            }
            if (idx > 0) {
                src_ = 'https://hls.mediacdn.vn/thanhnien' + src_;
            }
        }
        //console.log(src_);
        var html = '<video data-mute="true" id="' + id_ + '_video" controls="controls" data-poster="' + img_ + '" width="' + width_ + 'px" height="' + height_ + 'px" class="' + (isbeta ? 'BetaThanhnienPlayer' : 'player-100114 VFCPlayer') + '" data-file="' + src_ + '" data-vid="" data-vtype="' + vtype + '"></video>'; //src="' + src_ + '"
        $('#' + id_).html(html);

        if (videos.length == 0) {
            initvccorp();
        }
    }
    
}

var stopcheck = false;
window.setTimeout(function () { stopcheck = true; }, 60000);
function checkvideoload() {
    $('div[video-title] video:not([data-io-video-title])').each(function () {
        $(this).attr('data-io-video-title', $(this).parents('div[video-title]').attr('video-title'));
    });
    if (!stopcheck) {
        window.setTimeout(function () { checkvideoload(); }, 3000);
    }
}
function initvccorp() {
    (function (d, s) {
        var js, pjs = d.getElementsByTagName(s)[0];
        js = d.createElement(s);
        if (isbeta) {
            js.src = 'https://adminplayer.sohatv.vn/resource/init-script/playerInitSdk.js#secure=L3NlY3VyZS92ZXJpZnkveHZxcmNhZGhlYmZpMHY1dm5zM2Ywd3d3a3Y2MDdkMDgvMTAwMTIzL2V5SmhiR2NpT2lKSVV6STFOaUlzSW5SNWNDSTZJa3BYVkNKOS5leUp5WldZaU9pSWlMQ0poY0hCclpYa2lPaUo0ZG5GeVkyRmthR1ZpWm1rd2RqVjJibk16WmpCM2QzZHJkall3TjJRd09DSXNJbkJzWVhsbGNpSTZJakV3TURFeU15SXNJbWxuYm05eVpVVjRjR2x5WVhScGIyNGlPblJ5ZFdVc0ltbGhkQ0k2TVRVeU1ESTBOamcxTVN3aVpYaHdJam94TlRJd01qUTJPVEV4ZlEub3U0MjV2RE1OWkZzc1k5MjA1dWVBRGdpc0pIdU1HM3lwVnpjTTJ1QnkxMA==';
        } else {
            js.src = 'https://adminplayer.sohatv.vn/resource/init-script/playerInitSdk.js#secure=L3NlY3VyZS92ZXJpZnkveHZxcmNhZGhlYmZpMHY1dm5zM2Ywd3d3a3Y2MDdkMDgvMTAwMTE0L2V5SmhiR2NpT2lKSVV6STFOaUlzSW5SNWNDSTZJa3BYVkNKOS5leUp5WldZaU9pSWlMQ0poY0hCclpYa2lPaUo0ZG5GeVkyRmthR1ZpWm1rd2RqVjJibk16WmpCM2QzZHJkall3TjJRd09DSXNJbkJzWVhsbGNpSTZJakV3TURFeE5DSXNJbWxuYm05eVpVVjRjR2x5WVhScGIyNGlPblJ5ZFdVc0ltbGhkQ0k2TVRVeE9ERTJPRE15T1N3aVpYaHdJam94TlRFNE1UWTRORFE1ZlEueldSS19BU0IweUR5LWktV0JhbHNRZjNEb3BsLXBDbVVLbFduX25MbEY4NA==';
        }
        pjs.parentNode.insertBefore(js, pjs);
    }(document, 'script'));
    checkvideoload();
}
playvideos();
initvccorp();
$('#Tab a').on('click', function(e) {
    e.preventDefault();
    if ($('.site-header__grid').hasClass('affix-top')) { $('.site-header__grid').removeClass('affix-top').addClass('affix'); };
    $(this).tab('show');
});
if ($('#news_slimScroll').length > 0) {
    $('#news_slimScroll').slimScroll({
        height: 'auto'
    });
    $('#share_slimScroll').slimScroll({
        height: 'auto'
    });
}
function updateFloatAds() {
    if ($('#affixHeader').hasClass('affix')) {
        $('.float-ads.floattop').removeClass('floattop').addClass('floatbot').css('bottom', '0').css('top', 'auto');
    } else {
        $('.float-ads.floatbot').removeClass('floatbot').addClass('floattop').css('bottom', 'auto').css('top', $('#affixHeader').offset().top + $('#affixHeader').height() + 10);        
    }
}


var sspos = $(window).scrollTop();
var sspostop = 0;
var ssvisible = false;
/*--- Back2Top ---*/
jQuery(document).ready(function ($) {
    updateFloatAds();
    $('#affixHeader').on('affixed.bs.affix', function () {
        updateFloatAds();
    });
    $('#affixHeader').on('affixed-top.bs.affix', function () {
        updateFloatAds();
    });
    $('#latestbutton').click(function (e) {
        e.preventDefault();
        $(this).parent().toggleClass('open');
    });
    $('body').on('click', function (e) {
        if (!$('.dropdown-menu').is(e.target)
            && $('.dropdown-menu').has(e.target).length === 0
            && $('.open').has(e.target).length === 0
        ) {
            $('.item.item--tm.open').removeClass('open');
        }
    });

    // browser window scroll (in pixels) after which the "back to top" link is shown
    var offset = 300,
		//browser window scroll (in pixels) after which the "back to top" link opacity is reduced
		offset_opacity = 1200,
		//duration of the top scrolling animation (in ms)
		scroll_top_duration = 700,
		//grab the "back to top" link
		$back_to_top = $('.cd-top');

    //hide or show the "back to top" link
    $(window).scroll(function () {
        ($(this).scrollTop() > offset) ? $back_to_top.addClass('cd-is-visible') : $back_to_top.removeClass('cd-is-visible cd-fade-out');
        if ($(this).scrollTop() > offset_opacity) {
            $back_to_top.addClass('cd-fade-out');
        }
    });

    //smooth scroll to top
    $back_to_top.on('click', function (event) {
        event.preventDefault();
        $('body,html').animate({
            scrollTop: 0,
        }, scroll_top_duration
		);
    });
    $('a[href*=#]:not([href=#])').click(function () {
        if (location.pathname.replace(/^\//, '') == this.pathname.replace(/^\//, '') && location.hostname == this.hostname) {
            var target = $(this.hash);
            target = target.length ? target : $('[name=' + this.hash.slice(1) + ']');
            if (target.length) {
                $('html,body').animate({
                    scrollTop: target.offset().top - 120
                }, 500);
                return false;
            }
        }
    });

    //ss_box notify
    //if (getcookie("ssboxtop") !== "true") {
    //    $('#ss-content-top').show();
    //    $('#ss_btn_top').click(function (e) {
    //        e.preventDefault();
    //        $('#ss-content-top').hide();
    //        savecookiedaily("ssboxtop", "true", 1);
    //    });
    //}
    //ss_box content
    if (getcookie("ssboxbox") !== "true") {
        //$('#ss-content-container').show();
        
        // should start at 0
        $(window).scroll(function () {
            var ss = $(window).scrollTop();
            if (ss > sspos) {
                //console.log('scrollDown');
                if (ssvisible) {
                    sspostop = 0;
                    ssvisible = false;
                    $('#affixHeader').removeClass('has-ss-box');
                }
            } else {
                //console.log('scrollUp');                
                if (!ssvisible) {
                    if (sspostop === 0) sspostop = sspos;
                    if (sspostop - ss >= 200) {
                        ssvisible = true;
                        $('#affixHeader').addClass('has-ss-box');
                    }
                }
            }
            sspos = ss;
        });
        $('#ss_btn_close').click(function (e) {
            e.preventDefault();
            //$('#ss-content-container').hide();
            $('#affixHeader').removeClass('has-ss-box');
            savecookiedaily("ssboxbox", "true", 1);
        });
        $('#latestbutton').click(function () {
            if ($('#latestbox').is(':visible')) $('#affixHeader').removeClass('has-ss-box');
            else $('#affixHeader').addClass('has-ss-box');
        });
    }
    

    //updatetime();
    //$('.txtsearch').attr('placeholder', 'Tìm kiếm');
    ///*common*/
    $('.txtsearch').keypress(function (e) {
        if (e.which == 13) {
            e.preventDefault();
            dosearch($(this).val());
        }
    });
    $('.btnsearch').click(function (e) {
        e.preventDefault();
        dosearch($($(this).attr('rel') == '' ? '.txtsearch' : $(this).attr('rel')).val());
    });
    
    $('.sendmail').attr('href', 'mailto:email@domain.com?subject=' + window.encodeURIComponent(document.title) + '&body=' + window.encodeURIComponent(window.location.toString()));
    $('.sendsocial').click(function (e) {
        e.preventDefault();
        var url = '';
        switch ($(this).attr('rel')) {
            case "facebook":
                url = "https://www.facebook.com/sharer.php?u=" + window.location.href + "&p[title]=" + cutoffTitle(document.title);
                break;
            case "fbhome":
                url = "https://www.facebook.com/sharer.php?u=https://" + window.location.host;
                break;
            case "twitter":
                url = "https://twitter.com/share?url=" + window.location.href + "&title=" + cutoffTitle(document.title);
                break;
            case "gplus":
                url = "https://plus.google.com/share?url=" + window.location.href;
                break;
        }
        if (url == '') return false;
        var newWindow = window.open(url, '', '_blank,resizable=yes,width=800,height=450');
        newWindow.focus();
        return false;
    });
    
    $('.adsitem').mousedown(function (e) {
        if (logads($(this).attr('rel'), $(this).attr('tag'))) {
            ga('send', 'event', 'adsbanner', 'click', $(this).attr('tag'));
            //_gaq.push(['_trackEvent', 'adsbanner', 'click', $(this).attr('tag')]);
        }
    });
    $(window).blur(function () {
        try {
            if (iframeads != null) {
                var parent = $($(iframeads).parents('.adsitem')[0]);
                logads(parent.attr('rel'), parent.attr('tag'));
                ga('send', 'event', 'adsbanner', 'click', parent.attr('tag'));
                //_gaq.push(['_trackEvent', 'adsbanner', 'click', $(this).attr('tag')]);
            }
        } catch (e) {
            //console.log('blur');
            //console.log(e);
        }
    });
    $('.adsitem iframe').mouseover(function () {
        iframeads = $(this);
    }).mouseout(function () {
        iframeads = null;
    });
    window.setTimeout(function () {
        $('.adsitem iframe').mouseover(function () {
            iframeads = $(this);
        }).mouseout(function () {
            iframeads = null;
        });
    }, 3000);
    $('.votebutton').click(function (e) {
        e.preventDefault();
        var id = $(this).attr('rel');
        $('#loadingvote' + id).css('display', 'inline');
        var order = $('input:radio[name=vote' + id + ']:checked');
        if (order.length == 0 || parseInt(order.val()) == 'NaN') {
            alert('Bạn chưa chọn mục nào.');
            return false;
        }
        logvote(id, order.val());
        voteresult(id);
        window.setTimeout(function () { $('#loadingvote' + id).hide(); }, 5000);
    });
    $('.voteresult').click(function (e) {
        e.preventDefault();
        var id = $(this).attr('rel');
        $('#loadingvote' + id).css('display', 'inline');
        voteresult(id);
        window.setTimeout(function () { $('#loadingvote' + id).hide(); }, 5000);
    });
});
function dosearch(_keyword) {
    if (_keyword != '' && _keyword != 'Nội dung tìm kiếm') {
        $.ajax({
            type: "POST",
            url: loghost + "/ajax/tool.ashx?type=search&phrase=" + window.encodeURIComponent(_keyword),
            cache: true
        }).done(function (msg) {
            window.location = msg;
        });
    }
}
function voteresult(_contentid, _id) {
    $.ajax({
        url: "/ajax/vote.aspx?id=" + _id
    }).done(function (msg) {
        $('#storybox' + _contentid + ' #votebody' + _id).html(msg);
    });
}
function showvote(_contentid, voteid) {
    $.ajax({
        type: "POST",
        url: "/ajax/votebox.aspx",
        data: { id: voteid }
    }).done(function (msg) {
        $('#storybox' + _contentid + ' #votebox' + voteid).html(msg);
        $('#storybox' + _contentid + ' #votebox' + voteid).show();
        $('#storybox' + _contentid + ' .votebutton').click(function (e) {
            e.preventDefault();
            var id = $(this).attr('rel');
            $('#storybox' + _contentid + ' #loadingvote' + id).css('display', 'inline');
            var order = $('#storybox' + _contentid + ' input:radio[name=vote' + id + ']:checked');
            if (order.length == 0 || parseInt(order.val()) == 'NaN') {
                alert('Bạn chưa chọn mục nào.'); return false;
            }
            logvote(id, order.val());
            voteresult(_contentid, id);
            window.setTimeout(function () { $('#storybox' + _contentid + ' #loadingvote' + id).hide(); }, 5000);
        });
        $('#storybox' + _contentid + ' .voteresult').click(function (e) {
            e.preventDefault();
            var id = $(this).attr('rel');
            $('#storybox' + _contentid + ' #loadingvote' + id).css('display', 'inline');
            voteresult(_contentid, id);
            window.setTimeout(function () { $('#storybox' + _contentid + ' #loadingvote' + id).hide(); }, 5000);
        });
    });
}
function getNumberStr(_i) {
    return _i < 10 ? ('0' + _i) : _i;
}
function getWeekDay(_day) {
    switch (_day) {
        case 1: return "Thứ Hai";
        case 2: return "Thứ Ba";
        case 3: return "Thứ Tư";
        case 4: return "Thứ Năm";
        case 5: return "Thứ Sáu";
        case 6: return "Thứ Bảy";
        case 0: return "Chủ Nhật";
    }
}
var currenttime;
function updatetime() {
    if (currenttime == null) {
        $.ajax({
            url: loghost + '/ajax/tool.ashx?type=time',
            cache: false
        }).done(function (msg) {
            var d = new Date(eval(msg));
            d.setHours(d.getHours() - 7);
            currenttime = d;
            displayTime(d);
            window.setInterval(function () { updatetime(); }, 60000);
        });
    } else {
        currenttime.setSeconds(currenttime.getSeconds() + 60);
        displayTime(currenttime);
    }
}
function displayTime(d) {
    if (d == null) {
        updatetime();
        return;
    }
    //$('time.timeleft').each(function() {
    //    var time = new Date(eval($(this).attr('rel')));
    //    time.setHours(time.getHours() - 7);
    //    var span = time.getTime() - d.getTime();
    //    if (span < 0) span = span * (-1);
    //    var sDays = Math.floor(span / (24 * 60 * 60 * 1000));
    //    var sHours = Math.floor((span - sDays * (24 * 60 * 60 * 1000)) / (60 * 60 * 1000));
    //    var sMins = Math.floor((span - sDays * (24 * 60 * 60 * 1000) - sHours * (60 * 60 * 1000)) / (60 * 1000));
    //    $(this).find('.days').html((sDays < 10 ? "0" : "") + sDays);
    //    $(this).find('.hours').html((sHours < 10 ? "0" : "") + sHours);
    //    $(this).find('.mins').html((sMins < 10 ? "0" : "") + sMins);
    //});
    $('#fulldate').html(getNumberStr(d.getDate()) + '/' + getNumberStr(d.getMonth() + 1) + '/' + d.getFullYear());
    $('#fulltime').html(getWeekDay(d.getDay()) + ', ' + getNumberStr(d.getDate()) + '/' + getNumberStr(d.getMonth() + 1) + '/' + d.getFullYear() + ', ' + getNumberStr(d.getHours()) + ':' + getNumberStr(d.getMinutes()) + ':' + getNumberStr(d.getSeconds()) + ' GMT+7');
    $('.timebox').each(function () {
        if ($(this).hasClass('done')) return;
        var time = new Date(eval($(this).attr('rel')));
        time.setHours(time.getHours() - 7);
        var span = d.getTime() - time.getTime();
        var val = "";
        if (span >= 12 * 60 * 60 * 1000) {
            if ($(this).is('time')) {
                if (time.getDate() == d.getDate()) {
                    val = getNumberStr(time.getHours()) + ':' + getNumberStr(time.getMinutes());
                } else {
                    val = getNumberStr(time.getHours()) + ':' + getNumberStr(time.getMinutes()) + ', ' + getNumberStr(time.getDate()) + '/' + getNumberStr(time.getMonth() + 1) + '/' + getNumberStr(time.getFullYear());
                }
            }
        } else if (span >= 60 * 60 * 1000) {
            val = Math.floor(span / (60 * 60 * 1000)) + ' tiếng trước';
        } else {
            val = Math.floor(span / (60 * 1000)) + ' phút trước';
        }
        if (val != '') $(this).html(val);
        $(this).addClass('done');
    });
}

function getcookie(_logname) {
    var result;
    return (result = new RegExp('(?:^|; )' + encodeURIComponent(_logname) + '=([^;]*)').exec(document.cookie)) ? (result[1]) : null;
}
function savecookie(_logname, _value) {
    var date = new Date();
    date.setTime(date.getTime() + (365 * 24 * 60 * 60 * 1000));
    var expires = "; expires=" + date.toGMTString();
    document.cookie = _logname + "=" + _value + expires + "; path=/;";
}
function savecookiedaily(_logname, _value, _day) {
    var date = new Date();
    date.setTime(date.getTime() + (_day * 24 * 60 * 60 * 1000));
    var expires = "; expires=" + date.toGMTString();
    document.cookie = _logname + "=" + _value + expires + "; path=/;";
}
function loadlatest() {
    $.ajax({
        url: (typeof(currenttime) != 'undefined' ? '/latest.html?d=' + currenttime.getHours() + '-' + currenttime.getMinutes() : '/latest.html'),
        cache: true
}).done(function (msg) {
        var cookieTime = new Date(getcookie('latestclick'));
        if (isNaN(cookieTime.getDay()) || cookieTime.getFullYear() < 2000) {
            cookieTime = new Date();
            cookieTime.setHours(0);
            //savecookie('latestclick', cookieTime.toUTCString());
        }
        var notifyCount = 0; //parseInt($('#latestnotify').html());
        //if (isNaN(notifyCount)) {notifyCount = 0;}
        var latest = $('<div>' + msg + '</div>');
        latest.find('article').each(function () {
            var time = new Date(eval($(this).find('time').attr('rel')));
            time.setHours(time.getHours() - 7);
            if (cookieTime.getTime() < time.getTime()) {
                notifyCount++;
            }
            if ($('#latestbox > article[rel="' + $(this).attr('rel') + '"]').length > 0) {
                $(this).remove();
            }
        });
        $('#latestbox').prepend(latest.html());
        if (notifyCount <= 0) {
            $('#latestnotify').hide();
        } else {
            $('#latestnotify').html((notifyCount >= 10 ? "10+" : notifyCount)).show();
        }

        //displayTime(currenttime);
        window.setTimeout(function () { loadlatest(); }, 60000);
    });
}

$(document).ready(function() {
    loadlatest();
    $('#latestbutton').click(function(e) {
        $('#latestnotify').html('0').hide();
        //$('#latestbox > article time').removeClass('done');
        //displayTime(currenttime);
        var time = new Date(parseFloat($('#latestbox > article:first time').attr('rel'))+1);
        time.setHours(time.getHours() - 7);
        savecookie('latestclick', time.toUTCString());
    });
    if ($("#dsk_bxslider").length > 0) {
        $('#dsk_bxslider').bxSlider({
            mode: 'horizontal',
            moveSlides: 1,
            infiniteLoop: true,
            slideWidth: 660,
            minSlides: 4,
            maxSlides: 4,
            speed: 500,
            auto: true
        });
    }
});
function loadBgAds(_bgs) {

     if ($(window).width() > 1010 && $('#divBackground').length > 0) {
         if (_bgs.length > 0) {
                var _bidx = 0;
                if (_bgs.length > 1) {
                    _bidx = Math.floor(Math.random() * _bgs.length);
                }
                $('body').addClass('backgroundads').addClass('ready');
                $('.site-content').css('background', 'url("' + _bgs[_bidx].img + '") no-repeat 50% 0');
                $('.site-header__grid').on('affix.bs.affix', function (e) {
                    $('.site-content').css('background', 'none');
                    if ($('body').hasClass('ready')) { $('body').removeClass('ready').css('background', 'url("' + _bgs[_bidx].img + '") fixed no-repeat 50% 90px'); }
                });
                 $('.site-header__grid').on('affix-top.bs.affix', function (e) {
                     $('.site-content').css('background', 'url("' + _bgs[_bidx].img + '") no-repeat 50% 0');
             });
                if (_bgs[_bidx].link != '' && _bgs[_bidx].link != '#' && _bgs[_bidx].link != '/') {
                    var bgwidth = Math.floor(($(window).width() - 1030) / 2);
                    $('#divBackground #divL,#divBackground #divR').width(bgwidth).height($(window).height()).show().click(function (e) {
                        e.preventDefault();
                        e.stopPropagation();
                        window.open(_bgs[_bidx].link);
                    });
                    $('#floatLeftAds, #floatRightAds').hide();
                } else {
                    $('#divBackground #divL,#divBackground #divR').hide();
                    $('#floatLeftAds, #floatRightAds').show();
                }
            }
        }
}
if (typeof bgs != 'undefined') {
    loadBgAds(bgs);
}

//sticky
var stickyObjs = [];
$('.sticky').each(function () {
    var top = $($(this).attr('data-top'));
    var bottom = $($(this).attr('data-bot'));
    if (top.length == 0 || bottom.length == 0) return;
    stickyObjs.push({
        obj: $(this), topObj: top, bottomObj: bottom,
        height: isNaN($(this).attr('data-height')) ? $(this).height() : parseInt($(this).attr('data-height')),
        width: isNaN($(this).attr('data-width')) ? $(this).width() : parseInt($(this).attr('data-width')),
        offtop: parseInt($(this).attr('data-offset-top')), offbot: parseInt($(this).attr('data-offset-bot')),
        top: top.position().top, bot: bottom.position().top - $(this).height()
    });
});
function updatestickypos() {
    $(stickyObjs).each(function (_i, _o) {
        if (_o.height < 50) _o.height = _o.obj.height();
        if (_o.width == 0) _o.width = _o.obj.width();
        _o.top = _o.topObj.position().top;
        _o.bot = _o.bottomObj.position().top - _o.height;
    });
    window.setTimeout(function () { updatestickypos(); }, 3000);
}
if (stickyObjs.length > 0) {
    $(window).on("load", function () { updatestickypos(); });

    $(window).scroll(function () {
        var mytop = $(window).scrollTop();
        if (mytop > 100) mytop = mytop + 25; //affix menu
        $(stickyObjs).each(function (_i, _o) {
            var obj = _o.obj, top = _o.top + _o.offtop, bot = _o.bot - _o.offbot;
            if (mytop > top && top < bot) {
                if (mytop < bot) {
                    if (obj.css('position') != 'fixed') {
                        obj.css({ 'position': 'fixed', 'top': _o.offtop + 'px' }).width(_o.width + 'px');
                    }
                } else {
                    if (obj.css('position') != 'absolute') {
                        obj.css({ 'position': 'absolute', 'top': bot + 'px' });
                    }
                }
            } else {
                if (obj.css('position') != '') { obj.css('position', ''); }
            }
        });
    });
}

//searchbox
var searchScroll;
function updateSearchBoxPos() {
    var $input = $('input.gsc-input');
    if ($input.is(':visible')) {
        $('.gstl_50.gssb_c').css('top', ($input.offset().top + 30) + 'px');
    }
}
/*
var btnClicked = false;
$('.search-form').click(function() {
    btnClicked = true;
    window.setTimeout(function() { btnClicked = false; }, 1000);
});
function initSearchBoxPos() {
    if ($('.gstl_50.gssb_c').length > 0) {
        $('.gstl_50.gssb_c').click(function () {
            btnClicked = true;
            window.setTimeout(function () { btnClicked = false; }, 1000);
        });
    } else {
        window.setTimeout(function () { initSearchBoxPos(); }, 3000);
    }
}

window.setInterval(function () {
    var $this = $('.search-form .gsc-results-wrapper-nooverlay');
    if ($this.hasClass('gsc-results-wrapper-visible')) {
        $this.height($(window).height() - 130);
    } else {
        $this.height('auto');
    }
    updateSearchBoxPos()
}, 1000);
$(".item--tk").on("show.bs.dropdown", function (e) {
    searchScroll = $(window).scrollTop();
    //$('div.site-content, footer.site-footer, .site-header__topbanner').hide();
    //$('.site-header__grid').removeClass('affix-top').addClass('affix');
    updateSearchBoxPos();
});

//$('.site-header__grid').on('affix.bs.affix', function(e) {
//    if ($(".item--tk").hasClass('on')) {
//        $('.site-header__topbanner').hide();
//        updateSearchBoxPos();
//    }
//});
$('#btnggsearch').click(function (e) {
    e.preventDefault();
    if (!$('.item--tk').hasClass('on')) {
        setTimeout(function () { $('.search-form input.gsc-input').focus() }, 100);
    }
});
$(".item--tk").on("hide.bs.dropdown", function (event) {
    if (btnClicked) {
        event.preventDefault();
        event.stopPropagation();
        event.stopImmediatePropagation();
        return false;
        //$('div.site-content, footer.site-footer, div.site-header__topbanner').show();
        //$(window).scrollTop(searchScroll);
        //if (searchScroll < 100) {
        //    $('.site-header__grid').removeClass('affix').addClass('affix-top');
        //}
    }
});
window.setTimeout(function () { initSearchBoxPos(); }, 1000);*/
$('#btnggsearch').click(function (e) {
    e.preventDefault();
    if (!$('.item--tk').hasClass('open')) {
        setTimeout(function () { $('#txtsearch').focus() }, 100);
    }
});

function cutoffTitle(title) {
    title = title.toString();
    if (title.indexOf('|') > 0) { title = title.substr(0, title.lastIndexOf('|') - 1); }
    if (title.indexOf('|') > 0) { title = title.substr(0, title.lastIndexOf('|') - 1); }
    return title;
}
String.prototype.escape = function () { var tagsToReplace = { '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;' }; return this.replace(/[&<>]/g, function (tag) { return tagsToReplace[tag] || tag; }); };
$('#paging ul').addClass('pagination');

//if ($('#headerTopBanner').length == 0) {
//    fixAffixHeader();
//}
//function fixAffixHeader() {
//    if (typeof ($('#affixHeader').data('bs.affix')) === 'undefined') {
//        window.setTimeout(function () { fixAffixHeader() }, 1000); return;  
//    }
//    $('#affixHeader').data('bs.affix').options.offset.top = 0;
//}

var onloadGGCaptchaCallback = function () {

};
function hideRecaptcha() {
    const recaptcha = $(".grecaptcha-badge");
    if (recaptcha.length) return recaptcha.css({ display: "none" });
    requestAnimationFrame(() => this.hideRecaptcha());
}
try {
    hideRecaptcha();
} catch (e) {}


$('.shorten').each(function () {
    var i = 0; var h = parseInt($(this).parent().css('max-height').replace('px', ''));
    if (!h) return;
    while (i < 10 && $(this).height() > h) {
        $(this).html($(this).html().replace(/[\s]*[^\s]+[.!?]?$/, ''));
        i++;
    }
    if (i > 0) { $(this).html($(this).html().replace(/[\s]*[^\s]+[.!?]?$/, '') + ' ...'); }
});